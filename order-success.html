<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmation - BlessedShop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="bg-gray-800 text-white p-4 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">üôè BlessedShop</h1>
            <div class="flex gap-6">
                <a href="index.html" class="hover:text-gray-300">Home</a>
                <a href="products.html" class="hover:text-gray-300">Products</a>
                <a href="cart.html" class="hover:text-gray-300">Cart</a>
                <a href="profile.html" class="hover:text-gray-300" id="profileLink">Profile</a>
                <button id="logoutBtn" class="hover:text-gray-300 hidden">Logout</button>
                <a href="login.html" class="hover:text-gray-300" id="loginLink">Login</a>
            </div>
        </div>
    </nav>

    <!-- Success Message -->
    <section class="py-20 bg-gradient-to-b from-green-50 to-green-100 min-h-screen flex items-center justify-center">
        <div class="max-w-2xl mx-auto text-center px-4">
            <!-- Success Icon -->
            <div class="mb-8">
                <div class="inline-block bg-green-100 rounded-full p-8 mb-4">
                    <svg class="w-24 h-24 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                </div>
            </div>

            <h1 class="text-4xl font-bold text-green-600 mb-4">Order Confirmed! üéâ</h1>
            <p class="text-xl text-gray-700 mb-8">Thank you for your purchase from BlessedShop</p>

            <!-- Order Details -->
            <div class="bg-white rounded-lg shadow-lg p-8 mb-8 text-left">
                <h2 class="text-2xl font-bold mb-6 text-center">Order Details</h2>
                
                <div id="orderDetails" class="space-y-4">
                    <!-- Order details loaded dynamically -->
                </div>

                <div class="mt-8 pt-8 border-t">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <p class="text-blue-900 font-semibold mb-2">üìß Confirmation Email</p>
                        <p class="text-blue-800 text-sm">A detailed receipt has been sent to your email address. Check your inbox and spam folder.</p>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col md:flex-row gap-4 justify-center">
                <a href="profile.html" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-bold transition inline-block">
                    View My Orders
                </a>
                <button onclick="downloadOrderReceipt()" class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 font-bold transition">
                    Download Receipt
                </button>
                <a href="products.html" class="bg-gray-600 text-white px-8 py-3 rounded-lg hover:bg-gray-700 font-bold transition inline-block">
                    Continue Shopping
                </a>
            </div>

            <!-- Contact Info -->
            <div class="mt-12 text-gray-600">
                <p class="mb-2">Need help? Contact us at: <strong>support@blessedshop.com</strong></p>
                <p>We're here to help! 24/7 customer support available.</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white p-6 text-center">
        <p>&copy; 2025 BlessedShop. All rights reserved.</p>
    </footer>

    <script src="js/firebase.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/payment.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Get the last order (most recent)
            const user = getCurrentUser();
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            const userOrders = getUserOrders(user.email);
            if (userOrders.length === 0) {
                document.getElementById('orderDetails').innerHTML = '<p class="text-red-600">No order found</p>';
                return;
            }

            const latestOrder = userOrders[userOrders.length - 1];
            displayOrderDetails(latestOrder);
        });

        function displayOrderDetails(order) {
            const detailsDiv = document.getElementById('orderDetails');
            
            const itemsHTML = order.items.map(item => `
                <div class="flex justify-between py-2 border-b">
                    <span>${item.name} (x${item.quantity})</span>
                    <span>‚Ç¶${(item.price * item.quantity).toLocaleString()}</span>
                </div>
            `).join('');

            detailsDiv.innerHTML = `
                <div class="space-y-3">
                    <div>
                        <p class="text-gray-600 text-sm">Order Number</p>
                        <p class="text-2xl font-bold text-green-600">${order.id}</p>
                    </div>

                    <div>
                        <p class="text-gray-600 text-sm">Date</p>
                        <p class="font-semibold">${new Date(order.createdAt).toLocaleString()}</p>
                    </div>

                    <div>
                        <p class="text-gray-600 text-sm">Shipping To</p>
                        <p class="font-semibold">${order.customer.firstName} ${order.customer.lastName}</p>
                        <p class="text-gray-700">${order.shipping.address}</p>
                        <p class="text-gray-700">${order.shipping.city}, ${order.shipping.state} ${order.shipping.zipcode}</p>
                    </div>

                    <div class="my-6">
                        <p class="text-gray-600 text-sm mb-3 font-semibold">Items Ordered</p>
                        ${itemsHTML}
                    </div>

                    <div class="space-y-2 bg-gray-50 p-4 rounded-lg">
                        <div class="flex justify-between">
                            <span>Subtotal:</span>
                            <span>‚Ç¶${order.amounts.subtotal.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Shipping:</span>
                            <span>‚Ç¶${order.amounts.shipping.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Tax:</span>
                            <span>‚Ç¶${order.amounts.tax.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between font-bold text-lg border-t pt-2">
                            <span>Total:</span>
                            <span class="text-green-600">‚Ç¶${order.amounts.total.toLocaleString()}</span>
                        </div>
                    </div>

                    <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                        <p class="text-green-800">‚úì Payment Confirmed</p>
                        <p class="text-green-700 text-sm">Transaction ID: ${order.paymentId}</p>
                    </div>
                </div>
            `;

            // Store current order ID for receipt download
            localStorage.setItem('currentOrderId', order.id);
        }

        function downloadOrderReceipt() {
            const orderId = localStorage.getItem('currentOrderId');
            if (orderId) {
                downloadReceipt(orderId);
            } else {
                alert('Order not found');
            }
        }
    </script>
</body>
</html>
